<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>æ„Ÿæ©ä¹‹æ—…</title>
  <script type="module" crossorigin src="./assets/index-VH_soZc_.js"></script>
  <link rel="stylesheet" crossorigin href="./assets/index-Do3nq40W.css">
  
  <style>
    /* ç®€æ´éŸ³ä¹æ’­æ”¾å™¨æ ·å¼ */
    .simple-music-player {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
    }
    
    .music-toggle-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 25px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    
    .music-toggle-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }
    
    .music-toggle-btn:active {
      transform: translateY(0);
    }
    
    .music-toggle-btn.playing {
      background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
    }
    
    .music-toggle-btn.muted {
      background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
    }
    
    .music-status {
      position: absolute;
      top: -25px;
      right: 0;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none;
    }
    
    .music-status.show {
      opacity: 1;
    }
  </style>
</head>

<body>
  <div id="root"></div>
  
  <!-- ç®€æ´éŸ³ä¹æ’­æ”¾å™¨ -->
  <div class="simple-music-player">
    <div class="music-status" id="music-status"></div>
    <button class="music-toggle-btn" onclick="toggleMusic()" id="music-toggle">
      <span id="music-icon">ğŸ”Š</span>
      <span id="music-text">æ’­æ”¾éŸ³ä¹</span>
    </button>
  </div>

  <script>
    // éŸ³ä¹æ’­æ”¾å™¨çŠ¶æ€
    let backgroundAudio = null;
    let isPlaying = false;
    let isMuted = false;
    
    // æ˜¾ç¤ºçŠ¶æ€æç¤º
    function showStatus(message, duration = 2000) {
      const statusDiv = document.getElementById('music-status');
      statusDiv.textContent = message;
      statusDiv.classList.add('show');
      
      setTimeout(() => {
        statusDiv.classList.remove('show');
      }, duration);
    }
    
    // åˆå§‹åŒ–éŸ³ä¹æ’­æ”¾å™¨
    function initMusicPlayer() {
      if (!backgroundAudio) {
        // æ ¹æ®ç¯å¢ƒé€‰æ‹©æ­£ç¡®çš„éŸ³é¢‘è·¯å¾„
        let audioPath = './music/11.mp3';
        
        // å¦‚æœæ˜¯GitHub Pagesç¯å¢ƒï¼Œä½¿ç”¨ç»å¯¹è·¯å¾„
        if (window.location.hostname.includes('github.io')) {
          audioPath = window.location.origin + '/gratitude-album/music/11.mp3';
          console.log('GitHub Pagesç¯å¢ƒï¼Œä½¿ç”¨ç»å¯¹è·¯å¾„:', audioPath);
        }
        
        backgroundAudio = new Audio(audioPath);
        backgroundAudio.loop = true;
        backgroundAudio.volume = 0.5;
        backgroundAudio.preload = 'auto';
        
        // ç›‘å¬éŸ³é¢‘äº‹ä»¶
        backgroundAudio.addEventListener('canplaythrough', () => {
          console.log('éŸ³ä¹å·²åŠ è½½å®Œæˆ');
          showStatus('âœ… éŸ³ä¹åŠ è½½å®Œæˆ');
        });
        
        backgroundAudio.addEventListener('error', (e) => {
          console.error('éŸ³ä¹åŠ è½½å¤±è´¥:', e);
          showStatus('âŒ éŸ³ä¹åŠ è½½å¤±è´¥', 3000);
          
          // å¦‚æœå¤±è´¥ï¼Œå°è¯•å¤‡ç”¨è·¯å¾„
          if (audioPath !== './music/11.mp3') {
            console.log('å°è¯•ä½¿ç”¨ç›¸å¯¹è·¯å¾„...');
            backgroundAudio.src = './music/11.mp3';
            backgroundAudio.load();
          }
        });
        
        backgroundAudio.addEventListener('play', () => {
          isPlaying = true;
          updateMusicUI();
        });
        
        backgroundAudio.addEventListener('pause', () => {
          isPlaying = false;
          updateMusicUI();
        });
        
        // é¡µé¢åŠ è½½åè‡ªåŠ¨å°è¯•æ’­æ”¾ï¼ˆéœ€è¦ç”¨æˆ·äº¤äº’ï¼‰
        setTimeout(() => {
          if (backgroundAudio) {
            backgroundAudio.play().catch(error => {
              console.log('è‡ªåŠ¨æ’­æ”¾è¢«é˜»æ­¢ï¼Œç­‰å¾…ç”¨æˆ·äº¤äº’:', error.message);
              showStatus('ğŸ‘† ç‚¹å‡»é¡µé¢ä»»æ„ä½ç½®æ’­æ”¾éŸ³ä¹', 3000);
            });
          }
        }, 1000);
      }
    }
    
    // åˆ‡æ¢éŸ³ä¹æ’­æ”¾çŠ¶æ€
    async function toggleMusic() {
      if (!backgroundAudio) {
        initMusicPlayer();
        // ç­‰å¾…éŸ³é¢‘åˆå§‹åŒ–å®Œæˆ
        await new Promise(resolve => setTimeout(resolve, 100));
      }
      
      if (isMuted) {
        // å–æ¶ˆé™éŸ³
        backgroundAudio.volume = 0.5;
        isMuted = false;
        updateMusicUI();
        showStatus('ğŸ”Š å–æ¶ˆé™éŸ³');
      } else if (isPlaying) {
        // é™éŸ³
        backgroundAudio.volume = 0;
        isMuted = true;
        updateMusicUI();
        showStatus('ğŸ”‡ å·²é™éŸ³');
      } else {
        // æ’­æ”¾éŸ³ä¹
        await playMusic();
      }
    }
    
    // æ’­æ”¾éŸ³ä¹
    async function playMusic() {
      try {
        if (backgroundAudio.paused) {
          await backgroundAudio.play();
          showStatus('âœ… éŸ³ä¹æ’­æ”¾ä¸­');
        }
      } catch (error) {
        console.error('æ’­æ”¾å¤±è´¥:', error);
        
        if (error.name === 'NotAllowedError') {
          showStatus('ğŸ‘† è¯·ç‚¹å‡»é¡µé¢ä»»æ„ä½ç½®å…è®¸æ’­æ”¾', 3000);
        } else {
          showStatus('âŒ æ’­æ”¾å¤±è´¥', 3000);
        }
      }
    }
    
    // æ›´æ–°éŸ³ä¹æ’­æ”¾å™¨UI
    function updateMusicUI() {
      const toggleBtn = document.getElementById('music-toggle');
      const musicIcon = document.getElementById('music-icon');
      const musicText = document.getElementById('music-text');
      
      // é‡ç½®æŒ‰é’®æ ·å¼
      toggleBtn.classList.remove('playing', 'muted');
      
      if (isMuted) {
        musicIcon.textContent = 'ğŸ”‡';
        musicText.textContent = 'å–æ¶ˆé™éŸ³';
        toggleBtn.classList.add('muted');
      } else if (isPlaying) {
        musicIcon.textContent = 'ğŸ”Š';
        musicText.textContent = 'é™éŸ³';
        toggleBtn.classList.add('playing');
      } else {
        musicIcon.textContent = 'ğŸµ';
        musicText.textContent = 'æ’­æ”¾éŸ³ä¹';
      }
    }
    
    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
      initMusicPlayer();
      
      // æ·»åŠ é¡µé¢ç‚¹å‡»äº‹ä»¶ï¼Œç”¨äºè§¦å‘è‡ªåŠ¨æ’­æ”¾
      document.addEventListener('click', function() {
        if (!isPlaying && backgroundAudio && backgroundAudio.paused) {
          // ç”¨æˆ·ç‚¹å‡»é¡µé¢åå°è¯•è‡ªåŠ¨æ’­æ”¾
          playMusic().catch(console.error);
        }
      });
      
      // æ·»åŠ é”®ç›˜å¿«æ·é”®æ”¯æŒï¼ˆç©ºæ ¼é”®åˆ‡æ¢æ’­æ”¾/é™éŸ³ï¼‰
      document.addEventListener('keydown', function(e) {
        if (e.code === 'Space' && e.target.tagName !== 'INPUT' && e.target.tagName !== 'TEXTAREA') {
          e.preventDefault();
          toggleMusic();
        }
      });
      
      // GitHub Pagesç‰¹å®šä¿®å¤ï¼šå»¶è¿Ÿåˆå§‹åŒ–ï¼Œç¡®ä¿é¡µé¢å®Œå…¨åŠ è½½
      setTimeout(() => {
        // æ£€æŸ¥æ˜¯å¦æ˜¯GitHub Pagesç¯å¢ƒ
        if (window.location.hostname.includes('github.io')) {
          console.log('GitHub Pagesç¯å¢ƒæ£€æµ‹åˆ°ï¼Œåº”ç”¨éŸ³é¢‘ä¿®å¤');
          // é‡æ–°åˆå§‹åŒ–éŸ³é¢‘ï¼Œä½¿ç”¨ç»å¯¹è·¯å¾„
          if (backgroundAudio) {
            backgroundAudio.src = window.location.origin + '/gratitude-album/music/11.mp3';
            backgroundAudio.load();
          }
        }
      }, 2000);
    });
    
    // é¡µé¢å¯è§æ€§å˜åŒ–æ—¶å¤„ç†éŸ³ä¹æ’­æ”¾
    document.addEventListener('visibilitychange', function() {
      if (document.hidden && isPlaying && !isMuted) {
        // é¡µé¢éšè—æ—¶è‡ªåŠ¨é™éŸ³
        backgroundAudio.volume = 0;
        const tempMuted = true;
        updateMusicUI();
        
        // é¡µé¢æ˜¾ç¤ºæ—¶æ¢å¤éŸ³é‡
        const restoreVolume = function() {
          if (!document.hidden && tempMuted && !isMuted) {
            backgroundAudio.volume = 0.5;
            updateMusicUI();
            document.removeEventListener('visibilitychange', restoreVolume);
          }
        };
        document.addEventListener('visibilitychange', restoreVolume);
      }
    });
  </script>
</body>

</html>